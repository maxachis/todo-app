<div class="section" data-section-id="{{ section.id }}">
  <div class="section-header">
    <h2>
      {% if section.emoji %}{{ section.emoji }} {% endif %}{{ section.name }}
    </h2>
    <div class="section-actions">
      <button hx-post="/sections/{{ section.id }}/delete/"
              hx-target="#center-panel"
              hx-confirm="Delete this section?"
              class="btn btn-sm btn-danger">Delete</button>
    </div>
  </div>

  <div class="task-list sortable-tasks" data-section-id="{{ section.id }}">
    {% for task in section.tasks.all %}
      {% if not task.parent and not task.is_completed %}
        {% include "tasks/partials/task_item.html" with task=task depth=0 %}
      {% endif %}
    {% endfor %}
  </div>

  <form class="inline-form task-form"
        hx-post="/sections/{{ section.id }}/tasks/"
        hx-target="#center-panel"
        hx-swap="innerHTML">
    <input type="text" name="title" placeholder="Add a task..." required>
    <button type="submit" class="btn btn-sm">Add</button>
  </form>

  {% with completed=section.tasks.all %}
  {% for task in completed %}
    {% if task.is_completed and not task.parent %}
    {% if forloop.first %}
    <div class="completed-group">
      <h3>Completed</h3>
    {% endif %}
      {% include "tasks/partials/task_item.html" with task=task depth=0 %}
    {% if forloop.last %}
    </div>
    {% endif %}
    {% endif %}
  {% endfor %}
  {% endwith %}
</div>
