<details class="section" data-section-id="{{ section.id }}" open>
  <summary class="section-header" data-section-id="{{ section.id }}">
    <span class="section-toggle-icon"></span>
    <h2 class="section-name-display">
      {% if section.emoji %}{{ section.emoji }} {% endif %}{{ section.name }}
    </h2>
    <form class="section-edit-form"
          hx-post="/sections/{{ section.id }}/update/"
          hx-target="#center-panel"
          hx-swap="innerHTML"
          onclick="event.stopPropagation()">
      <input type="text" name="name" value="{{ section.name }}" class="section-edit-input">
      <button type="submit" class="btn btn-sm">Save</button>
      <button type="button" class="btn btn-sm btn-ghost section-edit-cancel">Cancel</button>
    </form>
    <div class="section-actions">
      <button type="button" class="btn btn-sm btn-ghost section-edit-btn"
              onclick="event.stopPropagation()">Edit</button>
      <button hx-post="/sections/{{ section.id }}/delete/"
              hx-target="#center-panel"
              hx-confirm="Delete this section?"
              class="btn btn-sm btn-danger"
              onclick="event.stopPropagation()">Delete</button>
    </div>
  </summary>

  <div class="task-list sortable-tasks" data-section-id="{{ section.id }}">
    {% for task in section.tasks.all %}
      {% if not task.parent and not task.is_completed %}
        {% include "tasks/partials/task_item.html" with task=task depth=0 %}
      {% endif %}
    {% endfor %}
  </div>

  <form class="inline-form task-form"
        hx-post="/sections/{{ section.id }}/tasks/"
        hx-target="previous .task-list"
        hx-swap="beforeend"
        hx-on::after-request="if(event.detail.successful) this.reset()">
    <input type="text" name="title" placeholder="Add a task..." required>
    <button type="submit" class="btn btn-sm">Add</button>
  </form>

  <details class="completed-group">
    <summary class="completed-toggle">
      <span class="completed-toggle-icon"></span>
      Completed
    </summary>
    <div class="completed-group-items">
      {% for task in section.tasks.all %}
        {% if task.is_completed and not task.parent %}
          {% include "tasks/partials/task_item.html" with task=task depth=0 %}
        {% endif %}
      {% endfor %}
    </div>
  </details>
</details>
