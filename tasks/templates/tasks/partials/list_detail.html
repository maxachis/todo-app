{% if active_list %}
<div class="list-header">
  <div class="list-header-left">
    <h1>
      {% if active_list.emoji %}{{ active_list.emoji }} {% endif %}{{ active_list.name }}
    </h1>
    {% if projects %}
    <select class="list-project-select"
            hx-post="/lists/{{ active_list.id }}/update/"
            hx-swap="none"
            name="project">
      <option value="">No project</option>
      {% for project in projects %}
      <option value="{{ project.id }}" {% if active_list.project_id == project.id %}selected{% endif %}>
        {{ project.name }}
      </option>
      {% endfor %}
    </select>
    {% endif %}
  </div>
  <div class="list-actions">
    <button type="button" class="btn btn-sm btn-ghost" id="toggle-all-sections" onclick="toggleAllSections()">Collapse All</button>
    <a href="/lists/{{ active_list.id }}/export/json/" class="btn btn-sm">JSON</a>
    <a href="/lists/{{ active_list.id }}/export/csv/" class="btn btn-sm">CSV</a>
    <a href="/lists/{{ active_list.id }}/export/md/" class="btn btn-sm">MD</a>
    <button hx-post="/lists/{{ active_list.id }}/delete/"
            hx-swap="none"
            hx-confirm="Delete this list?"
            class="btn btn-sm btn-danger">Delete List</button>
  </div>
</div>

{% if pinned_tasks %}
<div class="pinned-section">
  <div class="pinned-header">
    <svg class="pinned-header-icon" width="14" height="14" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 17v5"/><path d="M9 2h6l-1.5 5H15a3 3 0 0 1 3 3v2H6v-2a3 3 0 0 1 3-3h.5L8 2z"/></svg>
    <h3>Pinned</h3>
  </div>
  {% for task in pinned_tasks %}
    {% include "tasks/partials/task_item.html" with task=task depth=0 %}
  {% endfor %}
</div>
{% endif %}

<div class="sortable-sections" data-list-id="{{ active_list.id }}">
{% for section in sections %}
  {% include "tasks/partials/section.html" with section=section %}
{% endfor %}
</div>

<form class="inline-form section-form"
      hx-post="/lists/{{ active_list.id }}/sections/"
      hx-swap="none">
  <input type="text" name="name" placeholder="New section..." required>
  <input type="hidden" name="emoji" value="">
  <button type="button" class="emoji-trigger" data-emoji-target="emoji" title="Pick emoji">+</button>
  <button type="submit" class="btn btn-sm">Add Section</button>
</form>

{% if completed_tasks %}
<div class="completed-section">
  <h3>Completed</h3>
  {% for task in completed_tasks %}
    {% include "tasks/partials/task_item.html" with task=task %}
  {% endfor %}
</div>
{% endif %}

{% else %}
<p class="empty-state">Select or create a list to get started.</p>
{% endif %}
