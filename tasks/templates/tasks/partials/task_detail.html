{% load markdown_extras %}

<div class="task-detail-content">
  <button class="detail-close-btn" id="detail-close">&times;</button>
  <h2 id="detail-title">{{ task.title }}</h2>

  <form hx-post="/tasks/{{ task.id }}/update/"
        hx-swap="none"
        hx-trigger="change, md-save from:.md-editor">
    <div class="form-group">
      <label for="title">Title</label>
      <input type="text" name="title" value="{{ task.title }}" id="title">
    </div>

    <div class="form-group">
      <label for="notes">Notes (Markdown)</label>
      <textarea name="notes" id="notes" rows="6" style="display:none;">{{ task.notes }}</textarea>
      <div class="md-editor" contenteditable="true" data-target="notes" id="md-editor">{{ task.notes }}</div>
    </div>

    <div class="form-group">
      <label for="due_date">Due Date</label>
      <input type="date" name="due_date" id="due_date"
             value="{% if task.due_date %}{{ task.due_date|date:'Y-m-d' }}{% endif %}">
    </div>
  </form>

  <div id="rendered-notes" class="rendered-notes">
    {% if task.notes %}
    <h3>Preview</h3>
    {{ task.notes|render_markdown }}
    {% endif %}
  </div>

  <div class="task-tags">
    <h3>Tags</h3>
    {% for tag in task.tags.all %}
    <span class="tag">
      {{ tag.name }}
      <button hx-post="/tasks/{{ task.id }}/tags/{{ tag.id }}/"
              hx-target="#detail-panel"
              hx-swap="innerHTML"
              class="tag-remove">&times;</button>
    </span>
    {% endfor %}

    <form class="inline-form tag-form"
          hx-post="/tasks/{{ task.id }}/tags/"
          hx-target="#detail-panel"
          hx-swap="innerHTML">
      <input type="text" name="name" placeholder="Add tag..." required
             list="tag-suggestions" autocomplete="off">
      <button type="submit" class="btn btn-sm">Add</button>
    </form>
    <datalist id="tag-suggestions">
      {% for tag in available_tags %}
      <option value="{{ tag.name }}">
      {% endfor %}
    </datalist>
  </div>

  <div class="task-actions">
    <button hx-post="/tasks/{{ task.id }}/delete/"
            hx-target="#center-panel"
            hx-swap="innerHTML"
            hx-confirm="Delete this task?"
            class="btn btn-danger">Delete Task</button>
  </div>
</div>
