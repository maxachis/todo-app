services:
  backend:
    build:
      context: .
      dockerfile: Dockerfile.backend
    env_file:
      - deploy/.env.docker
    volumes:
      - ./db.sqlite3:/data/db.sqlite3
      - todoapp_static:/app/staticfiles
    restart: unless-stopped

  caddy:
    build:
      context: .
      dockerfile: Dockerfile.caddy
    env_file:
      - deploy/.env.docker
    depends_on:
      - backend
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - /etc/caddy/certs:/etc/caddy/certs:ro
      - todoapp_static:/srv/staticfiles:ro
      - caddy_data:/data
      - caddy_config:/config
    restart: unless-stopped

volumes:
  todoapp_static:
  caddy_data:
  caddy_config:
